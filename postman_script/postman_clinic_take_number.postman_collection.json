{
  "info": {
    "name": "Clinic Take Number System",
    "description": "API collection for clinic counter assignment and patient routing system",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{jwt_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "your_jwt_token_here",
      "type": "string"
    },
    {
      "key": "patient_profile_id",
      "value": "profile-uuid-1",
      "type": "string"
    },
    {
      "key": "counter_id",
      "value": "counter-uuid-1",
      "type": "string"
    },
    {
      "key": "appointment_id",
      "value": "appointment-uuid-1",
      "type": "string"
    },
    {
      "key": "invoice_id",
      "value": "invoice-uuid-1",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Counter Assignment",
      "item": [
        {
          "name": "Get Available Counters",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/available",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "available"]
            },
            "description": "Get list of available counters for patient assignment"
          }
        },
        {
          "name": "Get All Counters Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/status",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "status"]
            },
            "description": "Get status overview of all counters"
          }
        },
        {
          "name": "Assign Patient to Counter",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"appointmentId\": \"{{appointment_id}}\",\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"invoiceId\": \"{{invoice_id}}\",\n  \"patientName\": \"Nguyễn Văn A\",\n  \"patientAge\": 30,\n  \"patientGender\": \"MALE\",\n  \"isPregnant\": false,\n  \"isEmergency\": false,\n  \"isElderly\": false,\n  \"isDisabled\": false,\n  \"isVIP\": false,\n  \"specialNeeds\": [],\n  \"priorityLevel\": \"MEDIUM\",\n  \"notes\": \"Khám tổng quát\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/counter-assignment/assign",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "assign"]
            },
            "description": "Assign patient to available counter based on priority and availability"
          }
        },
        {
          "name": "Scan Invoice and Assign",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"invoiceCode\": \"INV2025001\",\n  \"appointmentCode\": \"APP2025001\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/counter-assignment/scan-invoice",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "scan-invoice"]
            },
            "description": "Scan invoice QR code and assign patient to counter"
          }
        },
        {
          "name": "Direct Assignment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Nguyễn Thị B\",\n  \"patientPhone\": \"0912345678\",\n  \"patientAge\": 25,\n  \"patientGender\": \"FEMALE\",\n  \"isPregnant\": false,\n  \"isEmergency\": false,\n  \"isElderly\": false,\n  \"isDisabled\": false,\n  \"isVIP\": false,\n  \"priorityLevel\": \"LOW\",\n  \"notes\": \"Khám phụ khoa\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/counter-assignment/direct-assignment",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Direct assignment without appointment or invoice"
          }
        },
        {
          "name": "Simple Assignment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Trần Văn C\",\n  \"priorityLevel\": \"HIGH\",\n  \"notes\": \"Cấp cứu\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/counter-assignment/simple-assignment",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "simple-assignment"]
            },
            "description": "Simple assignment with basic patient info"
          }
        },
        {
          "name": "Get Counter Queue",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/queue",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "queue"]
            },
            "description": "Get queue status for specific counter"
          }
        },
        {
          "name": "Get Current Patient",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/current-patient",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "current-patient"]
            },
            "description": "Get currently serving patient at counter"
          }
        },
        {
          "name": "Get Queue Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/queue-status",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "queue-status"]
            },
            "description": "Get detailed queue status for counter"
          }
        },
        {
          "name": "Call Next Patient",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/next-patient/{{counter_id}}",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "next-patient", "{{counter_id}}"]
            },
            "description": "Call next patient in queue"
          }
        },
        {
          "name": "Skip Current Patient",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/skip-current/{{counter_id}}",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "skip-current", "{{counter_id}}"]
            },
            "description": "Skip current patient and move to next"
          }
        },
        {
          "name": "Recall Skipped Patient",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/recall-skipped/{{counter_id}}",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "recall-skipped", "{{counter_id}}"]
            },
            "description": "Recall last skipped patient"
          }
        },
        {
          "name": "Return Current Patient to Queue",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/return-current/{{counter_id}}",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "return-current", "{{counter_id}}"]
            },
            "description": "Return current patient back to queue"
          }
        },
        {
          "name": "Return Previous Patient",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/return-previous/{{counter_id}}",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "return-previous", "{{counter_id}}"]
            },
            "description": "Return to previous patient"
          }
        },
        {
          "name": "Go Back to Previous Patient",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/go-back-previous/{{counter_id}}",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "go-back-previous", "{{counter_id}}"]
            },
            "description": "Go back to previous patient in history"
          }
        },
        {
          "name": "Set Counter Online",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/online",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "online"]
            },
            "description": "Set counter to online/active status"
          }
        },
        {
          "name": "Set Counter Offline",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/offline",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "offline"]
            },
            "description": "Set counter to offline/inactive status"
          }
        },
        {
          "name": "Clear Counter Queue",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/queue",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "queue"]
            },
            "description": "Clear all patients from counter queue"
          }
        },
        {
          "name": "Assign Receptionist to Counter",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"receptionistId\": \"receptionist-uuid-1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/assign-receptionist",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "assign-receptionist"]
            },
            "description": "Assign receptionist to manage counter"
          }
        },
        {
          "name": "Unassign Receptionist from Counter",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/counter-assignment/counters/{{counter_id}}/unassign-receptionist",
              "host": ["{{base_url}}"],
              "path": ["counter-assignment", "counters", "{{counter_id}}", "unassign-receptionist"]
            },
            "description": "Remove receptionist from counter"
          }
        }
      ]
    },
    {
      "name": "Take Number System",
      "item": [
        {
          "name": "Take Number (QR Code)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"qrCode\": \"PATIENT_PROFILE_CODE_123\",\n  \"patientName\": \"Nguyễn Văn A\",\n  \"patientPhone\": \"0912345678\",\n  \"isPregnant\": false,\n  \"isDisabled\": false,\n  \"isElderly\": false,\n  \"isEmergency\": false,\n  \"isVIP\": false,\n  \"notes\": \"Khám tổng quát\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/take-number/take",
              "host": ["{{base_url}}"],
              "path": ["take-number", "take"]
            },
            "description": "Take number using QR code scan"
          }
        },
        {
          "name": "Take Number (Appointment)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"appointmentCode\": \"APP2025001\",\n  \"patientName\": \"Nguyễn Văn A\",\n  \"patientPhone\": \"0912345678\",\n  \"isPregnant\": false,\n  \"isDisabled\": false,\n  \"isElderly\": false,\n  \"isEmergency\": false,\n  \"isVIP\": false,\n  \"notes\": \"Khám tổng quát\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/take-number/take",
              "host": ["{{base_url}}"],
              "path": ["take-number", "take"]
            },
            "description": "Take number using appointment code"
          }
        },
        {
          "name": "Take Number (Walk-in)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Nguyễn Thị B\",\n  \"patientPhone\": \"0987654321\",\n  \"isPregnant\": true,\n  \"isDisabled\": false,\n  \"isElderly\": false,\n  \"isEmergency\": false,\n  \"isVIP\": false,\n  \"notes\": \"Khám thai\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/take-number/take",
              "host": ["{{base_url}}"],
              "path": ["take-number", "take"]
            },
            "description": "Take number for walk-in patients"
          }
        },
        {
          "name": "Get All Tickets",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/take-number/tickets",
              "host": ["{{base_url}}"],
              "path": ["take-number", "tickets"]
            },
            "description": "Get all tickets from Redis stream"
          }
        },
        {
          "name": "Get Counter Tickets",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/take-number/tickets/counter/{{counter_id}}",
              "host": ["{{base_url}}"],
              "path": ["take-number", "tickets", "counter", "{{counter_id}}"]
            },
            "description": "Get tickets for specific counter"
          }
        },
        {
          "name": "Get Stream Info",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/take-number/stream/info",
              "host": ["{{base_url}}"],
              "path": ["take-number", "stream", "info"]
            },
            "description": "Get Redis stream information"
          }
        },
        {
          "name": "Get Consumer Groups",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/take-number/stream/groups",
              "host": ["{{base_url}}"],
              "path": ["take-number", "stream", "groups"]
            },
            "description": "Get Redis consumer groups information"
          }
        }
      ]
    },
    {
      "name": "Room Routing",
      "item": [
        {
          "name": "List Rooms",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/routing/rooms",
              "host": ["{{base_url}}"],
              "path": ["routing", "rooms"]
            },
            "description": "Get list of all clinic rooms with services and booth information"
          }
        },
        {
          "name": "Assign Patient to Rooms",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"serviceIds\": [\n    \"service-uuid-1\",\n    \"service-uuid-2\"\n  ],\n  \"requestedTime\": \"2025-09-13T10:00:00.000Z\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/routing/assign",
              "host": ["{{base_url}}"],
              "path": ["routing", "assign"]
            },
            "description": "Assign patient to appropriate rooms based on requested services"
          }
        },
        {
          "name": "Debug Work Sessions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/routing/debug/work-sessions",
              "host": ["{{base_url}}"],
              "path": ["routing", "debug", "work-sessions"]
            },
            "description": "Get debug information about active work sessions"
          }
        },
        {
          "name": "Mark Patient Left Temporarily",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"roomId\": \"room-uuid-1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/routing/status/left-temporarily",
              "host": ["{{base_url}}"],
              "path": ["routing", "status", "left-temporarily"]
            },
            "description": "Mark patient as temporarily left the room"
          }
        },
        {
          "name": "Mark Patient Returned",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"roomId\": \"room-uuid-1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/routing/status/returned",
              "host": ["{{base_url}}"],
              "path": ["routing", "status", "returned"]
            },
            "description": "Mark patient as returned to room"
          }
        },
        {
          "name": "Mark Patient Serving",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"roomId\": \"room-uuid-1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/routing/status/serving",
              "host": ["{{base_url}}"],
              "path": ["routing", "status", "serving"]
            },
            "description": "Mark patient as currently being served"
          }
        },
        {
          "name": "Mark Patient Waiting Result",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"roomId\": \"room-uuid-1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/routing/status/waiting-result",
              "host": ["{{base_url}}"],
              "path": ["routing", "status", "waiting-result"]
            },
            "description": "Mark patient as waiting for results"
          }
        },
        {
          "name": "Mark Patient Completed",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"roomId\": \"room-uuid-1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/routing/status/completed",
              "host": ["{{base_url}}"],
              "path": ["routing", "status", "completed"]
            },
            "description": "Mark patient visit as completed"
          }
        },
        {
          "name": "Mark Patient Skipped",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientProfileId\": \"{{patient_profile_id}}\",\n  \"roomId\": \"room-uuid-1\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/routing/status/skipped",
              "host": ["{{base_url}}"],
              "path": ["routing", "status", "skipped"]
            },
            "description": "Mark patient as skipped"
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Set timestamp for requests that need it",
          "pm.globals.set(\"timestamp\", new Date().toISOString());",
          "",
          "// Generate random ticket number if needed",
          "if (!pm.globals.get(\"ticket_number\")) {",
          "    pm.globals.set(\"ticket_number\", Math.floor(Math.random() * 1000) + 1);",
          "}"
        ]
      }
    }
  ]
}
