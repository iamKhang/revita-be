{
  "info": {
    "name": "Revita Routing API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "List rooms",
      "request": {
        "method": "GET",
        "header": [],
        "url": { "raw": "{{baseUrl}}/routing/rooms", "host": ["{{baseUrl}}"], "path": ["routing", "rooms"] }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('200 OK', () => pm.response.code === 200);",
              "const json = pm.response.json();",
              "pm.test('rooms is array', () => Array.isArray(json));",
              "pm.test('has roomCode', () => json.length === 0 || json[0].roomCode);"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Assign - Patient01 -> TRAM (RHM-01)",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/assign", "host": ["{{baseUrl}}"], "path": ["routing", "assign"] },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"patientProfileId\": \"{{patientProfileId1}}\",\n  \"serviceIds\": [\n    \"{{svc_TRAM}}\"\n  ]\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('201/200', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
              "const json = pm.response.json();",
              "pm.test('assignments array', () => Array.isArray(json.assignments) && json.assignments.length > 0);",
              "const a = json.assignments[0];",
              "pm.environment.set('assignedRoomId_1', a.roomId);",
              "pm.environment.set('assignedDoctorId_1', a.doctorId);",
              "pm.test('assigned room is RHM-01 for TRAM', () => pm.expect(a.roomCode).to.eql(pm.variables.get('roomCode_RHM01')));"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Assign - Patient02 -> TRAM (same room RHM-01)",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/assign", "host": ["{{baseUrl}}"], "path": ["routing", "assign"] },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"patientProfileId\": \"{{patientProfileId2}}\",\n  \"serviceIds\": [\n    \"{{svc_TRAM}}\"\n  ]\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('201/200', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
              "const json = pm.response.json();",
              "pm.test('assignments array', () => Array.isArray(json.assignments) && json.assignments.length > 0);",
              "const a = json.assignments[0];",
              "pm.environment.set('assignedRoomId_2', a.roomId);",
              "pm.environment.set('assignedDoctorId_2', a.doctorId);",
              "pm.test('same room as patient1', () => pm.expect(a.roomId).to.eql(pm.environment.get('assignedRoomId_1')));"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Status (roomId) - Patient01 LEFT_TEMPORARILY",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/status/left-temporarily", "host": ["{{baseUrl}}"], "path": ["routing", "status", "left-temporarily"] },
        "body": { "mode": "raw", "raw": "{\n  \"patientProfileId\": \"{{patientProfileId1}}\",\n  \"roomId\": \"{{assignedRoomId_1}}\"\n}" }
      },
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test('200', () => pm.response.code === 200);",
          "const json = pm.response.json();",
          "pm.test('ok true & status', () => { pm.expect(json.ok).to.be.true; pm.expect(json.status).to.eql('LEFT_TEMPORARILY'); });"
        ], "type": "text/javascript" } }
      ]
    },
    {
      "name": "Status (roomId) - Patient01 RETURNED",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/status/returned", "host": ["{{baseUrl}}"], "path": ["routing", "status", "returned"] },
        "body": { "mode": "raw", "raw": "{\n  \"patientProfileId\": \"{{patientProfileId1}}\",\n  \"roomId\": \"{{assignedRoomId_1}}\"\n}" }
      },
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test('200', () => pm.response.code === 200);",
          "const json = pm.response.json();",
          "pm.test('ok true & status', () => { pm.expect(json.ok).to.be.true; pm.expect(json.status).to.eql('RETURNED'); });"
        ], "type": "text/javascript" } }
      ]
    },
    {
      "name": "Status (roomId) - Patient01 SERVING",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/status/serving", "host": ["{{baseUrl}}"], "path": ["routing", "status", "serving"] },
        "body": { "mode": "raw", "raw": "{\n  \"patientProfileId\": \"{{patientProfileId1}}\",\n  \"roomId\": \"{{assignedRoomId_1}}\"\n}" }
      },
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test('200', () => pm.response.code === 200);",
          "const json = pm.response.json();",
          "pm.test('ok true & status', () => { pm.expect(json.ok).to.be.true; pm.expect(json.status).to.eql('SERVING'); });"
        ], "type": "text/javascript" } }
      ]
    },
    {
      "name": "Status (roomId) - Patient01 COMPLETED",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/status/completed", "host": ["{{baseUrl}}"], "path": ["routing", "status", "completed"] },
        "body": { "mode": "raw", "raw": "{\n  \"patientProfileId\": \"{{patientProfileId1}}\",\n  \"roomId\": \"{{assignedRoomId_1}}\"\n}" }
      },
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test('200', () => pm.response.code === 200);",
          "const json = pm.response.json();",
          "pm.test('ok true & status', () => { pm.expect(json.ok).to.be.true; pm.expect(json.status).to.eql('COMPLETED'); });"
        ], "type": "text/javascript" } }
      ]
    },
    {
      "name": "Status (roomId) - Patient02 SKIPPED",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/status/skipped", "host": ["{{baseUrl}}"], "path": ["routing", "status", "skipped"] },
        "body": { "mode": "raw", "raw": "{\n  \"patientProfileId\": \"{{patientProfileId2}}\",\n  \"roomId\": \"{{assignedRoomId_2}}\"\n}" }
      },
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test('200', () => pm.response.code === 200);",
          "const json = pm.response.json();",
          "pm.test('ok true & status', () => { pm.expect(json.ok).to.be.true; pm.expect(json.status).to.eql('SKIPPED'); });"
        ], "type": "text/javascript" } }
      ]
    },
    {
      "name": "Assign - Patient03 -> KHUCXA (MAT-01)",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/assign", "host": ["{{baseUrl}}"], "path": ["routing", "assign"] },
        "body": {
          "mode": "raw",
          "raw": "{\n  \"patientProfileId\": \"{{patientProfileId3}}\",\n  \"serviceIds\": [\n    \"{{svc_KHUCXA}}\"\n  ]\n}"
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('201/200', () => pm.expect(pm.response.code).to.be.oneOf([200,201]));",
              "const json = pm.response.json();",
              "pm.test('assignments array', () => Array.isArray(json.assignments) && json.assignments.length > 0);",
              "const a = json.assignments[0];",
              "pm.environment.set('assignedRoomId_3', a.roomId);",
              "pm.test('assigned room is MAT-01 for KHUCXA', () => pm.expect(a.roomCode).to.eql(pm.variables.get('roomCode_MAT01')));"
            ],
            "type": "text/javascript"
          }
        }
      ]
    },
    {
      "name": "Status (roomCode) - Patient03 SERVING",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/status/serving", "host": ["{{baseUrl}}"], "path": ["routing", "status", "serving"] },
        "body": { "mode": "raw", "raw": "{\n  \"patientProfileId\": \"{{patientProfileId3}}\",\n  \"roomCode\": \"{{roomCode_MAT01}}\"\n}" }
      },
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test('200', () => pm.response.code === 200);",
          "const json = pm.response.json();",
          "pm.test('ok true & status', () => { pm.expect(json.ok).to.be.true; pm.expect(json.status).to.eql('SERVING'); });"
        ], "type": "text/javascript" } }
      ]
    },
    {
      "name": "Status (roomCode) - Patient03 COMPLETED",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "url": { "raw": "{{baseUrl}}/routing/status/completed", "host": ["{{baseUrl}}"], "path": ["routing", "status", "completed"] },
        "body": { "mode": "raw", "raw": "{\n  \"patientProfileId\": \"{{patientProfileId3}}\",\n  \"roomCode\": \"{{roomCode_MAT01}}\"\n}" }
      },
      "event": [
        { "listen": "test", "script": { "exec": [
          "pm.test('200', () => pm.response.code === 200);",
          "const json = pm.response.json();",
          "pm.test('ok true & status', () => { pm.expect(json.ok).to.be.true; pm.expect(json.status).to.eql('COMPLETED'); });"
        ], "type": "text/javascript" } }
      ]
    }
  ],
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:3000" },
    { "key": "patientProfileId1", "value": "66666666-6666-6666-6666-666666666601" },
    { "key": "patientProfileId2", "value": "66666666-6666-6666-6666-666666666602" },
    { "key": "patientProfileId3", "value": "66666666-6666-6666-6666-666666666603" },
    { "key": "svc_TRAM", "value": "44444444-4444-4444-4444-444444444403" },
    { "key": "svc_KHUCXA", "value": "44444444-4444-4444-4444-444444444406" },
    { "key": "roomCode_RHM01", "value": "RHM-01" },
    { "key": "roomCode_MAT01", "value": "MAT-01" },
    { "key": "assignedRoomId_1", "value": "" },
    { "key": "assignedRoomId_2", "value": "" },
    { "key": "assignedRoomId_3", "value": "" },
    { "key": "assignedDoctorId_1", "value": "" },
    { "key": "assignedDoctorId_2", "value": "" }
  ]
}
