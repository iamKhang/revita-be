{
  "info": {
    "name": "Counter Assignment API V2",
    "description": "Collection để test hệ thống phân bổ quầy khám với Queue Logic V2 (Next, Previous, Skip, Recall, Return) và Kafka integration",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000/api",
      "type": "string"
    },
    {
      "key": "token",
      "value": "your-jwt-token-here",
      "type": "string"
    },
    {
      "key": "counterId",
      "value": "your-counter-id-here",
      "type": "string"
    },
    {
      "key": "receptionistId",
      "value": "c9d215bc-a273-4dac-99c2-0ef6031889b2",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Counter Assignment",
      "item": [
        {
          "name": "1. Get Available Counters",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/available",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "available"]
            },
            "description": "Lấy danh sách các quầy có sẵn"
          }
        },
        {
          "name": "2. Get System Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/status",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "status"]
            },
            "description": "Xem tổng quan trạng thái hệ thống"
          }
        },
        {
          "name": "3. Simple Assignment (Bốc số đơn thuần)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/simple-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "simple-assignment"]
            },
            "description": "Bốc số đơn thuần - không cần thông tin gì"
          }
        },
        {
          "name": "4. Direct Assignment (Nhập thông tin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Nguyễn Văn A\",\n  \"patientAge\": 75,\n  \"patientGender\": \"MALE\",\n  \"patientPhone\": \"0901234567\",\n  \"serviceName\": \"Khám tổng quát\",\n  \"servicePrice\": 200000,\n  \"isElderly\": true,\n  \"priorityLevel\": \"HIGH\",\n  \"notes\": \"Bệnh nhân cao tuổi, cần ưu tiên\",\n  \"assignedBy\": \"{{receptionistId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Phân bổ với thông tin chi tiết"
          }
        },
        {
          "name": "5. Scan Invoice Assignment",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"invoiceId\": \"your-invoice-id-here\",\n  \"deviceId\": \"electron-app-001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/scan-invoice",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "scan-invoice"]
            },
            "description": "Quét hóa đơn và phân bổ"
          }
        },
        {
          "name": "6. Get Counter Queue",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/{{counterId}}/queue",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "{{counterId}}", "queue"]
            },
            "description": "Xem hàng đợi của một quầy cụ thể"
          }
        },
        {
          "name": "7. Next Patient",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/next-patient/{{counterId}}",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "next-patient", "{{counterId}}"]
            },
            "description": "Gọi bệnh nhân tiếp theo cho quầy"
          }
        },
        {
          "name": "8. Set Counter Online",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/{{counterId}}/online",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "{{counterId}}", "online"]
            },
            "description": "Đặt quầy online"
          }
        },
        {
          "name": "9. Set Counter Offline",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/{{counterId}}/offline",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "{{counterId}}", "offline"]
            },
            "description": "Đặt quầy offline"
          }
        },
        {
          "name": "10. Clear Counter Queue",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/{{counterId}}/queue",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "{{counterId}}", "queue"]
            },
            "description": "Xóa toàn bộ hàng đợi của quầy"
          }
        }
      ]
    },
    {
      "name": "Counter Management",
      "item": [
        {
          "name": "11. Return Current Patient to Queue",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/return-previous/{{counterId}}",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "return-previous", "{{counterId}}"]
            },
            "description": "Đưa bệnh nhân hiện tại quay lại queue (đầu queue)"
          }
        },
        {
          "name": "12. Go Back to Previous Patient",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/go-back-previous/{{counterId}}",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "go-back-previous", "{{counterId}}"]
            },
            "description": "Quay lại bệnh nhân trước đó từ history"
          }
        },
        {
          "name": "13. Skip Current Patient",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/skip-current/{{counterId}}",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "skip-current", "{{counterId}}"]
            },
            "description": "Skip bệnh nhân hiện tại (chuyển vào skipped queue)"
          }
        },
        {
          "name": "14. Recall Skipped Patient",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/recall-skipped/{{counterId}}",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "recall-skipped", "{{counterId}}"]
            },
            "description": "Gọi lại bệnh nhân đã skip từ skipped queue"
          }
        },
        {
          "name": "15. Return Current Patient to Queue",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/return-current/{{counterId}}",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "return-current", "{{counterId}}"]
            },
            "description": "Đưa bệnh nhân hiện tại quay lại queue (đầu queue)"
          }
        },
        {
          "name": "16. Get Queue Status (Enhanced)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/{{counterId}}/queue-status",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "{{counterId}}", "queue-status"]
            },
            "description": "Lấy trạng thái đầy đủ của queue (current, queue, history, skipped)"
          }
        },
        {
          "name": "17. Assign Receptionist to Counter",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" },
              { "key": "Content-Type", "value": "application/json", "type": "text" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"receptionistId\": \"your-receptionist-id-here\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/{{counterId}}/assign-receptionist",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "{{counterId}}", "assign-receptionist"]
            },
            "description": "Gán receptionist cho quầy"
          }
        },
        {
          "name": "18. Unassign Receptionist from Counter",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Authorization", "value": "Bearer {{token}}", "type": "text" }
            ],
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/counters/{{counterId}}/unassign-receptionist",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "counters", "{{counterId}}", "unassign-receptionist"]
            },
            "description": "Bỏ gán receptionist khỏi quầy"
          }
        }
      ]
    },
    {
      "name": "Queue Logic V2 Testing",
      "item": [
        {
          "name": "Test Case V2-1: Next và Previous Flow",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Test Patient A\",\n  \"patientAge\": 30,\n  \"patientGender\": \"MALE\",\n  \"patientPhone\": \"0901234001\",\n  \"serviceName\": \"Khám tổng quát\",\n  \"servicePrice\": 200000,\n  \"priorityLevel\": \"MEDIUM\",\n  \"notes\": \"Test case cho Next/Previous flow\",\n  \"assignedBy\": \"{{receptionistId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Thêm bệnh nhân A để test Next/Previous"
          }
        },
        {
          "name": "Test Case V2-2: Skip và Recall Flow",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Test Patient B\",\n  \"patientAge\": 25,\n  \"patientGender\": \"FEMALE\",\n  \"patientPhone\": \"0901234002\",\n  \"serviceName\": \"Khám tổng quát\",\n  \"servicePrice\": 200000,\n  \"priorityLevel\": \"MEDIUM\",\n  \"notes\": \"Test case cho Skip/Recall flow\",\n  \"assignedBy\": \"{{receptionistId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Thêm bệnh nhân B để test Skip/Recall"
          }
        },
        {
          "name": "Test Case V2-3: Return to Queue Flow",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Test Patient C\",\n  \"patientAge\": 40,\n  \"patientGender\": \"MALE\",\n  \"patientPhone\": \"0901234003\",\n  \"serviceName\": \"Khám tổng quát\",\n  \"servicePrice\": 200000,\n  \"priorityLevel\": \"MEDIUM\",\n  \"notes\": \"Test case cho Return to Queue flow\",\n  \"assignedBy\": \"{{receptionistId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Thêm bệnh nhân C để test Return to Queue"
          }
        }
      ]
    },
    {
      "name": "Test Cases",
      "item": [
        {
          "name": "Test Case 1: Bệnh nhân cao tuổi",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Nguyễn Thị Bà\",\n  \"patientAge\": 78,\n  \"patientGender\": \"FEMALE\",\n  \"patientPhone\": \"0901234568\",\n  \"serviceName\": \"Khám tổng quát\",\n  \"servicePrice\": 200000,\n  \"isElderly\": true,\n  \"priorityLevel\": \"HIGH\",\n  \"notes\": \"Bệnh nhân cao tuổi, cần ưu tiên\",\n  \"assignedBy\": \"{{counterId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Test case cho bệnh nhân cao tuổi (>70)"
          }
        },
        {
          "name": "Test Case 2: Phụ nữ có thai",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Trần Thị C\",\n  \"patientAge\": 28,\n  \"patientGender\": \"FEMALE\",\n  \"patientPhone\": \"0901234569\",\n  \"serviceName\": \"Khám thai\",\n  \"servicePrice\": 300000,\n  \"isPregnant\": true,\n  \"priorityLevel\": \"HIGH\",\n  \"notes\": \"Phụ nữ có thai, cần ưu tiên\",\n  \"assignedBy\": \"{{counterId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Test case cho phụ nữ có thai"
          }
        },
        {
          "name": "Test Case 3: Bệnh nhân cấp cứu",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Lê Văn D\",\n  \"patientAge\": 45,\n  \"patientGender\": \"MALE\",\n  \"patientPhone\": \"0901234570\",\n  \"serviceName\": \"Cấp cứu\",\n  \"servicePrice\": 500000,\n  \"isEmergency\": true,\n  \"priorityLevel\": \"HIGH\",\n  \"notes\": \"Bệnh nhân cấp cứu, cần ưu tiên cao nhất\",\n  \"assignedBy\": \"{{counterId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Test case cho bệnh nhân cấp cứu"
          }
        },
        {
          "name": "Test Case 4: Bệnh nhân thường",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"patientName\": \"Phạm Thị E\",\n  \"patientAge\": 35,\n  \"patientGender\": \"FEMALE\",\n  \"patientPhone\": \"0901234571\",\n  \"serviceName\": \"Khám tổng quát\",\n  \"servicePrice\": 200000,\n  \"priorityLevel\": \"MEDIUM\",\n  \"notes\": \"Bệnh nhân thường\",\n  \"assignedBy\": \"{{counterId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/direct-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "direct-assignment"]
            },
            "description": "Test case cho bệnh nhân thường"
          }
        },
        {
          "name": "Test Case 5: Bốc số đơn thuần",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{}"
            },
            "url": {
              "raw": "{{baseUrl}}/counter-assignment/simple-assignment",
              "host": ["{{baseUrl}}"],
              "path": ["counter-assignment", "simple-assignment"]
            },
            "description": "Test case cho bốc số đơn thuần"
          }
        }
      ]
    }
  ]
}
